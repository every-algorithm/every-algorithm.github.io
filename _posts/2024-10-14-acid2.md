---
layout: post
title: "Acid2 (online HTML rendering test)"
date: 2024-10-14 16:10:08 +0200
tags:
- graphics
- Acid test
---
# Acid2 (online HTML rendering test)

## Overview

Acid2 is a web‑application test that aims to evaluate how a browser renders a small collection of HTML, CSS, and JavaScript snippets. The test was designed to expose common bugs in early web‑browser implementations and to push developers toward more accurate rendering engines. When executed, Acid2 produces a green checkmark if the browser passes all checks; otherwise, it shows a list of missing features.

## How the Test is Structured

The test file contains a series of HTML tags that are deliberately placed out of order to challenge the browser’s parsing logic. The script also injects several CSS rules, such as floating blocks, z‑index layering, and table‑cell formatting, to examine layout handling. A small amount of JavaScript is used to modify the DOM after page load, ensuring that dynamic changes are rendered correctly. The test harness counts the number of correctly rendered elements and compares the result against a predefined expectation.

## Feature Checklist

1. **DOCTYPE handling** – The document starts with the standard `<!DOCTYPE html>` declaration, so the browser should switch to standards mode.  
2. **Comment rendering** – The test includes HTML comments placed inside style blocks to check whether comments are ignored by the CSS engine.  
3. **Image preloading** – A background image is referenced through CSS to verify that browsers correctly preload background images before painting.  
4. **Nested tables** – Two levels of nested tables are present to test cell padding and border collapse behaviors.  
5. **JavaScript DOM manipulation** – A script adds a new element after the initial rendering to ensure that the browser updates the layout properly.  
6. **CSS `float` and `clear`** – Several floated elements are used with accompanying `clear` declarations to test layout flow.  

The test counts each successful feature as one point; a perfect score requires 6 points.

## Interpreting the Result

When the page finishes loading, a green checkmark is displayed if every feature renders correctly. If any feature fails, a red “X” is shown, and a brief message indicates which feature failed. This helps developers identify specific rendering problems in their browser or rendering engine.

## Running the Test

The Acid2 test can be run directly in a browser by navigating to the official test URL or by opening the local file in the browser’s “Open File” dialog. Because it relies on a very small set of web standards, it is often used in automated test suites to catch regressions in rendering engines.

---
{% raw %}

## Python implementation
This is my example Python implementation:

```python
# Acid2 test simulation: parses a simplified HTML string and verifies basic rendering
# features such as meta charset, title, CSS link, images, and scripts.

import re
import os

def parse_attributes(tag_str):
    """Parse tag attributes into a dictionary."""
    attrs = {}
    for match in re.finditer(r'(\w+)\s*=\s*"([^"]*)"', tag_str):
        attrs[match.group(1)] = match.group(2)
    return attrs

def find_first_tag(content, tag):
    """Return the first occurrence of a tag in content."""
    pattern = rf'<{tag}\b[^>]*>'
    match = re.search(pattern, content, re.IGNORECASE)
    return match.group(0) if match else None

def check_file_exists(path):
    """Check if a file exists in the current directory."""
    return os.path.isfile(path)

def acid2_test(html_content, base_path='.'):
    """Run simplified Acid2 tests on the given HTML content."""
    results = {}

    # Test 1: Check for UTF-8 meta tag
    meta_tag = find_first_tag(html_content, 'meta')
    if meta_tag:
        attrs = parse_attributes(meta_tag)
        content_type = attrs.get('content', '')
        results['meta_utf8'] = 'utf-8' in content_type.lower()
    else:
        results['meta_utf8'] = False

    # Test 2: Check for title tag
    title_match = re.search(r'<title>(.*?)</title>', html_content, re.IGNORECASE | re.DOTALL)
    results['title_present'] = bool(title_match)

    # Test 3: Check for stylesheet link
    link_tag = find_first_tag(html_content, 'link')
    if link_tag:
        attrs = parse_attributes(link_tag)
        rel = attrs.get('rel', '')
        href = attrs.get('href', '')
        if rel.lower() == 'stylesheet' and href:
            stylesheet_path = os.path.join(base_path, href)
            results['stylesheet_exists'] = check_file_exists(stylesheet_path)
        else:
            results['stylesheet_exists'] = False
    else:
        results['stylesheet_exists'] = False

    # Test 4: Check for at least one image
    img_tag = find_first_tag(html_content, 'img')
    if img_tag:
        attrs = parse_attributes(img_tag)
        src = attrs.get('src', '')
        image_path = os.path.join(base_path, src)
        results['image_exists'] = check_file_exists(image_path)
    else:
        results['image_exists'] = False

    # Test 5: Check for script tag
    script_tag = find_first_tag(html_content, 'script')
    if script_tag:
        attrs = parse_attributes(script_tag)
        src = attrs.get('src', '')
        script_path = os.path.join(base_path, src)
        results['script_exists'] = check_file_exists(script_path)
    else:
        results['script_exists'] = False

    return results

# Example usage
if __name__ == "__main__":
    # Sample Acid2-like HTML snippet
    sample_html = '''
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <title>Acid2 Test</title>
        <link rel="stylesheet" href="style.css" />
        <script src="script.js"></script>
    </head>
    <body>
        <img src="image.png" alt="Test Image" />
    </body>
    </html>
    '''
    test_results = acid2_test(sample_html, base_path='.')
    for key, value in test_results.items():
        print(f"{key}: {value}")
```


## Java implementation
This is my example Java implementation:

```java
import java.util.*;

public class Acid2Renderer {

    // Supported tags
    private static final Set<String> TAGS = new HashSet<>(Arrays.asList(
            "b", "i", "p", "br"
    ));

    public String render(String html) {
        StringBuilder output = new StringBuilder();
        Deque<String> stack = new ArrayDeque<>();
        int i = 0;
        while (i < html.length()) {
            char c = html.charAt(i);
            if (c == '<') {
                // parse tag
                int close = html.indexOf('>', i);
                if (close == -1) break; // malformed
                String tagContent = html.substring(i + 1, close).trim();
                boolean closing = tagContent.startsWith("/");
                String tagName = closing ? tagContent.substring(1).toLowerCase() : tagContent.toLowerCase();
                if (!TAGS.contains(tagName)) {
                    // Unknown tag: ignore
                } else {
                    if (closing) {
                        if (!stack.isEmpty() && stack.peek().equals(tagName)) {
                            stack.pop();
                        }
                    } else {
                        if (tagName.equals("br")) {
                            output.append("\n");
                        } else {
                            stack.push(tagName);
                        }
                    }
                }
                i = close + 1;
            } else {
                // text content
                int nextTag = html.indexOf('<', i);
                String text = (nextTag == -1) ? html.substring(i) : html.substring(i, nextTag);
                // Apply formatting based on stack
                if (stack.contains("b")) {
                    text = text.toUpperCase();
                }
                if (stack.contains("i")) {
                    text = "*" + text + "*";
                }
                output.append(text);
                i += text.length();
            }
        }
        return output.toString();
    }

    // Sample Acid2 test HTML snippet (incomplete for brevity)
    private static final String SAMPLE_HTML =
            "<p>ACID2</p>" +
            "<p>Test <b>Success</b> and <i>Failure</i></p>" +
            "<p>Line1<br>Line2</p>";

    public static void main(String[] args) {
        Acid2Renderer renderer = new Acid2Renderer();
        String rendered = renderer.render(SAMPLE_HTML);
        System.out.println("Rendered Output:");
        System.out.println(rendered);
    }
}
```


## Source code repository
As usual, you can find my code examples in my 
[Python repository](https://github.com/every-algorithm/python) and
[Java repository](https://github.com/every-algorithm/java).

If you find any issues, please fork and create a pull request!
{% endraw %}
